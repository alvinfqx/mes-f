var data1 = {
    total: 6,
    rows: [
        {
            Equipment: "Equipment",
            EquipmentName: "EquipmentName",
            ResourceClass: "ResourceClass",
            Usage: "Usage",
            EquipmentCode: "EquipmentCode",
            EquipmentID: "EquipmentID",
            AreaDesc: "AreaDesc",
            PlantDesc: "PlantDesc",
            UsageImgUrl: "/content/images/logo/login-icon.png",
            EquipmentImgUrl: "/content/images/backgrounImg.jpg",
            DAQMachID: "DAQMachID",
            WorkCenterNo: "WorkCenterNo",
            WorkCenterDesc: "WorkCenterDesc",
            Department: "Department",
            DepartmentName: "DepartmentName",
            WorkCenterID: "WorkCenterID",
            HasProcess: true,
            ItemCode: "ItemCode",
            WorkOrderNo: "WorkOrderNo",
            WorkOrderSeq: "WorkOrderSeq",
            ProcessSeq: "ProcessSeq",
            ProcessNo: "ProcessNo",
            ProcessDesc: "ProcessDesc",
            Remark: "Remark",
            WorkCenterNo: "WorkCenterNo",
            WorkCenterDesc: "WorkCenterDesc",
            OperationSeq: "OperationSeq",
            OperationNo: "OperationNo",
            OperationDesc: "OperationDesc",
            StartDate: "2017/07/05",
            FinishDate: "2017/07/05",
            Status: "Status",
            MeasureTime: "12:05:05",
            EventID: "EventID",
            EventDesc: "EventDesc",
            DeviceDesc: "DeviceDesc",
            Sensor: "Sensor1",
            SensorDesc: "SensorDesc",
            Measurement: "9",
            MaxAlarmValue: null,
            MinAlarmValue: null,
            Max: null,
            Min: null,
        },
        {
            Equipment: "Equipment2",
            EquipmentName: "EquipmentName2",
            ResourceClass: "ResourceClass2",
            Usage: "Usage2",
            EquipmentCode: "EquipmentCode2",
            EquipmentID: "EquipmentID2",
            AreaDesc: "AreaDesc2",
            PlantDesc: "PlantDesc2",
            UsageImgUrl: "/content/images/logo/login-icon.png",
            EquipmentImgUrl: "/content/images/backgrounImg2.png",
            DAQMachID: "DAQMachID2",
            WorkCenterNo: "WorkCenterNo2",
            WorkCenterDesc: "WorkCenterDesc2",
            Department: "Department2",
            DepartmentName: "DepartmentName2",
            WorkCenterID: "WorkCenterID2",
            HasProcess: false,
            ItemCode: "ItemCode2",
            WorkOrderNo: "WorkOrderNo2",
            WorkOrderSeq: "WorkOrderSeq2",
            ProcessSeq: "ProcessSeq2",
            ProcessNo: "ProcessNo2",
            ProcessDesc: "ProcessDesc2",
            Remark: "Remark",
            WorkCenterNo: "WorkCenterNo2",
            WorkCenterDesc: "WorkCenterDesc2",
            OperationSeq: "2",
            OperationNo: "OperationNo2",
            OperationDesc: "OperationDesc2",
            StartDate: "2017/07/06",
            FinishDate: "2017/07/06",
            Status: "Status",
            MeasureTime: "12:05:15",
            EventID: "EventID",
            EventDesc: "EventDesc",
            DeviceDesc: "DeviceDesc",
            Sensor: "Sensor2",
            SensorDesc: "SensorDesc",
            Measurement: 11,
            MaxAlarmValue: 12,
            MinAlarmValue: 10,
            Max: 16,
            Min: 8,
        }, {
            Equipment: "Equipment2",
            EquipmentName: "EquipmentName2",
            ResourceClass: "ResourceClass2",
            Usage: "Usage2",
            EquipmentCode: "EquipmentCode2",
            EquipmentID: "EquipmentID2",
            AreaDesc: "AreaDesc2",
            PlantDesc: "PlantDesc2",
            UsageImgUrl: "/content/images/logo/login-icon.png",
            EquipmentImgUrl: "/content/images/backgrounImg2.png",
            DAQMachID: "DAQMachID2",
            WorkCenterNo: "WorkCenterNo2",
            WorkCenterDesc: "WorkCenterDesc2",
            Department: "Department2",
            DepartmentName: "DepartmentName2",
            WorkCenterID: "WorkCenterID2",
            HasProcess: false,
            ItemCode: "ItemCode2",
            WorkOrderNo: "WorkOrderNo2",
            WorkOrderSeq: "WorkOrderSeq2",
            ProcessSeq: "ProcessSeq2",
            ProcessNo: "ProcessNo2",
            ProcessDesc: "ProcessDesc2",
            Remark: "Remark",
            WorkCenterNo: "WorkCenterNo2",
            WorkCenterDesc: "WorkCenterDesc2",
            OperationSeq: "2",
            OperationNo: "OperationNo2",
            OperationDesc: "OperationDesc2",
            StartDate: "2017/07/06",
            FinishDate: "2017/07/06",
            Status: "Status",
            MeasureTime: "12:05:15",
            EventID: "EventID",
            EventDesc: "EventDesc",
            DeviceDesc: "DeviceDesc",
            Sensor: "Sensor3",
            SensorDesc: "SensorDesc",
            Measurement: "11",
            MaxAlarmValue: null,
            MinAlarmValue: null,
            Max: null,
            Min: null,
        }, {
            Equipment: "Equipment2",
            EquipmentName: "EquipmentName2",
            ResourceClass: "ResourceClass2",
            Usage: "Usage2",
            EquipmentCode: "EquipmentCode2",
            EquipmentID: "EquipmentID2",
            AreaDesc: "AreaDesc2",
            PlantDesc: "PlantDesc2",
            UsageImgUrl: "/content/images/logo/login-icon.png",
            EquipmentImgUrl: "/content/images/backgrounImg2.png",
            DAQMachID: "DAQMachID2",
            WorkCenterNo: "WorkCenterNo2",
            WorkCenterDesc: "WorkCenterDesc2",
            Department: "Department2",
            DepartmentName: "DepartmentName2",
            WorkCenterID: "WorkCenterID2",
            HasProcess: false,
            ItemCode: "ItemCode2",
            WorkOrderNo: "WorkOrderNo2",
            WorkOrderSeq: "WorkOrderSeq2",
            ProcessSeq: "ProcessSeq2",
            ProcessNo: "ProcessNo2",
            ProcessDesc: "ProcessDesc2",
            Remark: "Remark",
            WorkCenterNo: "WorkCenterNo2",
            WorkCenterDesc: "WorkCenterDesc2",
            OperationSeq: "2",
            OperationNo: "OperationNo2",
            OperationDesc: "OperationDesc2",
            StartDate: "2017/07/06",
            FinishDate: "2017/07/06",
            Status: "Status",
            MeasureTime: "12:05:15",
            EventID: "EventID",
            EventDesc: "EventDesc",
            DeviceDesc: "DeviceDesc",
            Sensor: "Sensor4",
            SensorDesc: "SensorDesc",
            Measurement: 12,
            MaxAlarmValue: 12,
            MinAlarmValue: 10,
            Max: 16,
            Min: 8,
        }, {
            Equipment: "Equipment2",
            EquipmentName: "EquipmentName2",
            ResourceClass: "ResourceClass2",
            Usage: "Usage2",
            EquipmentCode: "EquipmentCode2",
            EquipmentID: "EquipmentID2",
            AreaDesc: "AreaDesc2",
            PlantDesc: "PlantDesc2",
            UsageImgUrl: "/content/images/logo/login-icon.png",
            EquipmentImgUrl: "/content/images/backgrounImg2.png",
            DAQMachID: "DAQMachID2",
            WorkCenterNo: "WorkCenterNo2",
            WorkCenterDesc: "WorkCenterDesc2",
            Department: "Department2",
            DepartmentName: "DepartmentName2",
            WorkCenterID: "WorkCenterID2",
            HasProcess: false,
            ItemCode: "ItemCode2",
            WorkOrderNo: "WorkOrderNo2",
            WorkOrderSeq: "WorkOrderSeq2",
            ProcessSeq: "ProcessSeq2",
            ProcessNo: "ProcessNo2",
            ProcessDesc: "ProcessDesc2",
            Remark: "Remark",
            WorkCenterNo: "WorkCenterNo2",
            WorkCenterDesc: "WorkCenterDesc2",
            OperationSeq: "2",
            OperationNo: "OperationNo2",
            OperationDesc: "OperationDesc2",
            StartDate: "2017/07/06",
            FinishDate: "2017/07/06",
            Status: "Status",
            MeasureTime: "12:05:15",
            EventID: "EventID",
            EventDesc: "EventDesc",
            DeviceDesc: "DeviceDesc",
            Sensor: "Sensor5",
            SensorDesc: "SensorDesc",
            Measurement: 9,
            MaxAlarmValue: 12,
            MinAlarmValue: 10,
            Max: 16,
            Min: 8,
        }, {
            Equipment: "Equipment2",
            EquipmentName: "EquipmentName2",
            ResourceClass: "ResourceClass2",
            Usage: "Usage2",
            EquipmentCode: "EquipmentCode2",
            EquipmentID: "EquipmentID2",
            AreaDesc: "AreaDesc2",
            PlantDesc: "PlantDesc2",
            UsageImgUrl: "/content/images/logo/login-icon.png",
            EquipmentImgUrl: "/content/images/backgrounImg2.png",
            DAQMachID: "DAQMachID2",
            WorkCenterNo: "WorkCenterNo2",
            WorkCenterDesc: "WorkCenterDesc2",
            Department: "Department2",
            DepartmentName: "DepartmentName2",
            WorkCenterID: "WorkCenterID2",
            HasProcess: false,
            ItemCode: "ItemCode2",
            WorkOrderNo: "WorkOrderNo2",
            WorkOrderSeq: "WorkOrderSeq2",
            ProcessSeq: "ProcessSeq2",
            ProcessNo: "ProcessNo2",
            ProcessDesc: "ProcessDesc2",
            Remark: "Remark",
            WorkCenterNo: "WorkCenterNo2",
            WorkCenterDesc: "WorkCenterDesc2",
            OperationSeq: "2",
            OperationNo: "OperationNo2",
            OperationDesc: "OperationDesc2",
            StartDate: "2017/07/06",
            FinishDate: "2017/07/06",
            Status: "Status",
            MeasureTime: "12:05:15",
            EventID: "EventID",
            EventDesc: "EventDesc",
            DeviceDesc: "DeviceDesc",
            Sensor: "Sensor6",
            SensorDesc: "SensorDesc",
            Measurement: 7,
            MaxAlarmValue: 12,
            MinAlarmValue: 10,
            Max: 16,
            Min: 8,
        }
    ]
};
var data2 = {
    datasets: [{
        label: 'title',
        data: [{ y: 5, x: "2017/07/05 04:37:01" },
        { y: 7, x: "2017/07/05 04:37:10" },
        { y: 9, x: "2017/07/05 04:37:20" },
        { y: 3, x: "2017/07/05 04:37:30" },
        { y: 4, x: "2017/07/05 04:37:40" },
        { y: 5, x: "2017/07/05 04:37:50" },
        { y: 6, x: "2017/07/05 04:38:00" },
        { y: 8, x: "2017/07/05 04:38:10" },
        { y: 2, x: "2017/07/05 04:38:20" },
        { y: 5, x: "2017/07/05 04:38:30" },
        { y: 7, x: "2017/07/05 04:38:40" },
        ],
        backgroundColor: [
            'rgba(255, 255, 255, 0)',
        ],
        borderColor: [
            'rgba(255,99,132,1)',
        ],
        borderWidth: 1
    }, {
        label: 'max',
        data: [{ y: 8, x: "2017/07/05 04:37:01" },
        { y: 8, x: "2017/07/05 04:37:10" },
        { y: 8, x: "2017/07/05 04:37:20" },
        { y: 8, x: "2017/07/05 04:37:30" },
        { y: 8, x: "2017/07/05 04:37:40" },
        { y: 8, x: "2017/07/05 04:37:50" },
        { y: 8, x: "2017/07/05 04:38:00" },
        { y: 8, x: "2017/07/05 04:38:10" },
        { y: 8, x: "2017/07/05 04:38:20" },
        { y: 8, x: "2017/07/05 04:38:30" },
        { y: 8, x: "2017/07/05 04:38:40" },
        ],
        borderWidth: 1,
        backgroundColor: [
            'rgba(255, 255, 255, 0)',
        ],
        borderColor: ['rgba(0,0,255,1)'],
    }, {
        label: 'min',
        data: [{ y: 4, x: "2017/07/05 04:37:01" },
        { y: 4, x: "2017/07/05 04:37:10" },
        { y: 4, x: "2017/07/05 04:37:20" },
        { y: 4, x: "2017/07/05 04:37:30" },
        { y: 4, x: "2017/07/05 04:37:40" },
        { y: 4, x: "2017/07/05 04:37:50" },
        { y: 4, x: "2017/07/05 04:38:00" },
        { y: 4, x: "2017/07/05 04:38:10" },
        { y: 4, x: "2017/07/05 04:38:20" },
        { y: 4, x: "2017/07/05 04:38:30" },
        { y: 4, x: "2017/07/05 04:38:40" },
        ],
        borderWidth: 1,
        backgroundColor: [
            'rgba(255, 255, 255, 0)',
        ],
        borderColor: ['rgba(0,255,0,1)'],
    }]
}
var data3 = {
    datasets: [{
        label: 'title2',
        data: [{ y: 11, x: "2017/07/05 04:37:01" },
        { y: 17, x: "2017/07/05 04:37:10" },
        { y: 13, x: "2017/07/05 04:37:20" },
        { y: 13, x: "2017/07/05 04:37:30" },
        { y: 14, x: "2017/07/05 04:37:40" },
        { y: 17, x: "2017/07/05 04:37:50" },
        { y: 16, x: "2017/07/05 04:38:00" },
        { y: 18, x: "2017/07/05 04:38:10" },
        { y: 16, x: "2017/07/05 04:38:20" },
        { y: 15, x: "2017/07/05 04:38:30" },
        { y: 11, x: "2017/07/05 04:38:40" },
        ],
        backgroundColor: [
            'rgba(255, 255, 255, 0)',
        ],
        borderColor: [
            'rgba(255,99,132,1)',
        ],
        borderWidth: 1
    }, {
        label: 'max',
        data: [{ y: 18, x: "2017/07/05 04:37:01" },
        { y: 18, x: "2017/07/05 04:37:10" },
        { y: 18, x: "2017/07/05 04:37:20" },
        { y: 18, x: "2017/07/05 04:37:30" },
        { y: 18, x: "2017/07/05 04:37:40" },
        { y: 18, x: "2017/07/05 04:37:50" },
        { y: 18, x: "2017/07/05 04:38:00" },
        { y: 18, x: "2017/07/05 04:38:10" },
        { y: 18, x: "2017/07/05 04:38:20" },
        { y: 18, x: "2017/07/05 04:38:30" },
        { y: 18, x: "2017/07/05 04:38:40" },
        ],
        borderWidth: 1,
        backgroundColor: [
            'rgba(255, 255, 255, 0)',
        ],
        borderColor: ['rgba(0,0,255,1)'],
    }, {
        label: 'min',
        data: [{ y: 14, x: "2017/07/05 04:37:01" },
        { y: 14, x: "2017/07/05 04:37:10" },
        { y: 14, x: "2017/07/05 04:37:20" },
        { y: 14, x: "2017/07/05 04:37:30" },
        { y: 14, x: "2017/07/05 04:37:40" },
        { y: 14, x: "2017/07/05 04:37:50" },
        { y: 14, x: "2017/07/05 04:38:00" },
        { y: 14, x: "2017/07/05 04:38:10" },
        { y: 14, x: "2017/07/05 04:38:20" },
        { y: 14, x: "2017/07/05 04:38:30" },
        { y: 14, x: "2017/07/05 04:38:40" },
        ],
        borderWidth: 1,
        backgroundColor: [
            'rgba(255, 255, 255, 0)',
        ],
        borderColor: ['rgba(0,255,0,1)'],
    }]
}
var viewModel = function () {
    var self = this;
    var table = null;
    //var Namearry = [];

    //mf.ajax({
    //    type: 'Get',
    //    async: false,
    //    url: "/MES-TD/api/Util/GetParameters",
    //    data: { "typeIDs": "0191213000055" },// 機況
    //    success: function (data) {
    //        var Listdata = data.PT0191213000055;
    //        for (var i = 0; i < Listdata.length; i++) {
    //            Namearry[i] = { value: Listdata[i].value, text: Listdata[i].text }
    //        }
    //    }
    //});

    //查询
    this.searchClick = function () {

    };
    // 刷新
    this.refreshClick = function () {
        //if (!table)
        //    return;

        LoadSensor();
        //table.goForword(function () {
        //    window.top.page_parameters.Caching.push({ URL: URL, Parameters: MID });
        //    window.location.reload();
        //}
        //,function () {
        //    window.top.page_parameters.Caching.push({ URL: URL, Parameters: MID });
        //    window.location.reload();
        //}
        // );
    };



    //设置厂商表格
    var EquipmentTable = new mf.Table("#EquipmentTable", {
        uniqueId: "EquipmentID",
        paginationBar: new mf.PaginationBar("#paginagionEquipmentBar"),
        fn_getData: function (pagination, searchData, success) {

            var Code = $("#Code").val();

            mf.ajax({
                type: 'Get',
                url: '/MES-TD/api/IntelligentCouplet/lot00003EquipmentGetList',
                data: ({ page: pagination.page, rows: pagination.rows, Code: Code }),
                success: function (data) {
                    ExportTotal = data.total;
                    success(data);
                }
            });
            success(data1);
        },
        fn_saveData: function (saveData, success) {

        },
        fn_onEditingRowArgsCheck: function ($row, rowdata, isAdding) {

            return null;
        },
        focusField: "Code",
        focusEditField: "Status",
        //height: window.innerHeight - 143,
        columns: [
            {
                field: 'Equipment', title: fields.Equipment, align: "center", require: true, width: "100",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 9, maxLength: 20, title: "title" })),

            },
            {
                field: 'EquipmentName', title: fields.EquipmentName, require: true, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 60, title: "title" })),

            },
            {
                field: 'ResourceClass', title: fields.ResourceType, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 120, title: "title" })),
            },
            {
                field: 'Usage', title: fields.MechanicalCondition, align: "center", width: "80",

            }
        ]
    });



    // 設備主檔查詢
    this.CodeSearch = function () {
        //EquipmentTable.goForwordSafely(function () {
        EquipmentTable.loadData();
        //}, null);
    };

    //清除数据
    this.clearInput = function (ID) {
        $(ID).val("");
    };
    // 開啟廠商彈窗
    this.SearchCode = function () {
        $("#EquipmentDialog").modal("show");
        $("#EquipmentDialog").modal({ backdrop: 'static', keyboard: false });
        EquipmentTable.loadData();
        $("#EquipmentCommit").unbind();
        $("#EquipmentCommit").click(function () {
            var row = EquipmentTable.getSelectedData();
            if (row) {
                $("#EquipmentCode").val(row.EquipmentCode);
                $("#EquipmentName").text(row.EquipmentName);
                $("#EquipmentID").text(row.EquipmentID);
                $("#DAQMachID").text(row.DAQMachID);
                $("#ResourceClass").text(row.ResourceClass);
                $("#Usage").text(row.Usage);
                $("#AreaDesc").text(row.AreaDesc);
                $("#PlantDesc").text(row.PlantDesc);
                $("#UsageImgUrl").attr("src", row.UsageImgUrl);
                $("#EquipmentImgUrl").attr("src", row.EquipmentImgUrl);
                $("#EquipmentDialog").modal("hide");
                if (timer) clearTimeout(timer);// 已經在跑的先停掉
                LoadSensor(row.DAQMachID);// 啟動定時器
            }
        });
    }
    var timer = null;// 定時器，可用於停止
    // 定時讀取感知器
    var LoadSensor = function (DAQMachID) {
        //mf.ajax({
        //    type: 'Get',
        //    url: '/MES-TD/api/IntelligentCouplet/lot00003SensorGetList',
        //    data: ({ page: pagination.page, rows: pagination.rows, DAQMachID: DAQMachID}),
        //    success: function (data) {
        //        ExportTotal = data.total;
        //        success(data);
        //    }
        //});
        var dataSource = new kendo.data.DataSource({
            data: data1.rows,
            pageSize: 21
        });



        $("#listView").kendoListView({
            dataSource: dataSource,
            template: kendo.template($("#template").html()),
            dataBound: function () {
                // 完成後有上下限值的做gauge
                $(data1.rows).each(function () {
                    if (this.Max != null && this.Min != null) {

                        $("#gauge_" + this.Sensor).kendoLinearGauge({

                            pointer: {
                                value: this.Measurement,
                                shape: "BARINDICATOR",
                                color: "#ffff00"
                            },
                            gaugeArea: {
                                height: 60,
                                width: 380
                            },
                            scale: {

                                min: this.Min,
                                max: this.Max,
                                vertical: false,
                                ranges: [
                                    {
                                        from: this.MaxAlarmValue,
                                        to: this.MinAlarmValue,
                                        color: "#ff0000"
                                        //}, {
                                        //    from: this.Min,
                                        //    to: this.MinAlarm,
                                        //    color: "#ff7a00"
                                        //    }, {
                                        //        from: 150,
                                        //        to: 180,
                                        //        color: "#c20000"
                                    }
                                ]
                            }
                        });
                    }
                });
                // 完成後做語系
                $('#listView [data-meaning]').each(function (i, elem) {
                    var $elem = $(elem);
                    for (var key in fields) {
                        if ($elem.attr('data-meaning') == key) {
                            if ($elem[0].tagName == "INPUT") {
                                if ($elem[0].type == "text") {
                                    $elem.attr('placeholder', fields[key]);
                                }
                                else {
                                    $elem.val(fields[key]);
                                }
                            }
                            else {
                                $elem.text(fields[key]);
                            }
                        }
                    }
                });
            }
        });
        // todo:要放在ajax success裡
        // timer = window.setTimeout(LoadSensor, 10000);// 10秒一次
    }
    // 開啟趨勢圖
    this.showChart = function (DAQMachID, Sensor) {
        var data;
        if (Sensor == "Sensor1") data = data2;
        else data = data3;
        $("#ChartDialog").modal("show");
        $("#ChartDialog").modal({ backdrop: 'static', keyboard: false });
        //WorkCenterTable.loadData();
        var ctx = $("#myChart");
        var myChart = new Chart(ctx, {
            type: 'line',
            data: data,
            options: {
                scales: {
                    xAxes: [{
                        type: 'time',
                        displayFormats: {
                            quarter: 'mm:ss'
                        },
                        time: {
                            unit: 'second'
                        }
                    }]
                }
            }
        });
    }
    //工作中心表格
    var WorkCenterTable = new mf.Table("#WorkCenterTable", {
        uniqueId: "WorkCenterID",
        editable: false,
        paginationBar: new mf.PaginationBar("#paginagionWorkCenterBar"),
        operateColumWidth: "70px",
        fn_createBtn: function (data) {
            var $td = $("<td style='text-align:center; width:70px;'> ");
            if (data.HasProcess) {
                // 是否有製程關系
                // 8.该操作按钮，当该工作中心有制程关系时才显示出来，当工作中心没有制程关系时不显示
                $td.append('<button class="btn btn-success btn-xs" onclick="model.ProcessClick(this)" title="製程關系" >' + fields.ProcessRelating + '</button>&nbsp;&nbsp;');
            }

            return $td;
        },
        fn_getData: function (pagination, searchData, success) {

            var Code = $("#EquipmentCode").val();

            //mf.ajax({
            //    type: 'Get',
            //    url: '/MES-TD/api/IntelligentCouplet/lot00003WorkCenterGetList',
            //    data: ({ page: pagination.page, rows: pagination.rows, Code: Code}),
            //    success: function (data) {
            //        ExportTotal = data.total;
            //        success(data);
            //    }
            //});
            success(data1);
        },
        fn_saveData: function (saveData, success) {

        },
        fn_onEditingRowArgsCheck: function ($row, rowdata, isAdding) {

            return null;
        },
        focusField: "WorkCenterNo",
        focusEditField: "WorkCenterNo",
        //height: window.innerHeight - 143,
        columns: [
            {
                field: 'WorkCenterNo', title: fields.WorkCenterNo, align: "center", require: true, width: "100",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 9, maxLength: 20, title: "title" })),

            },
            {
                field: 'WorkCenterDesc', title: fields.WorkCenterDescription, require: true, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 60, title: "title" })),

            },
            {
                field: 'Department', title: fields.DepartmentNo, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 120, title: "title" })),
            },
            {
                field: 'DepartmentName', title: fields.DepartmentDescription, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 120, title: "title" })),
            }
        ]
    });
    //製程關係表格
    var ProcessTable = new mf.Table("#ProcessTable", {
        uniqueId: "ProcessID",
        editable: false,
        paginationBar: new mf.PaginationBar("#paginagionProcessBar"),
        fn_getData: function (pagination, searchData, success) {
            var row = WorkCenterTable.getRowData($Row);
            var Code = row.WorkCenterID;

            //mf.ajax({
            //    type: 'Get',
            //    url: '/MES-TD/api/IntelligentCouplet/lot00003ProcessGetList',
            //    data: ({ page: pagination.page, rows: pagination.rows, WorkCenterID: Code}),
            //    success: function (data) {
            //        ExportTotal = data.total;
            //        success(data);
            //    }
            //});
            success(data1);
        },
        fn_saveData: function (saveData, success) {

        },
        fn_onEditingRowArgsCheck: function ($row, rowdata, isAdding) {

            return null;
        },
        focusField: "ProcessNo",
        focusEditField: "ProcessNo",
        //height: window.innerHeight - 143,
        columns: [
            {
                field: 'ProcessNo', title: fields.ProcessNo, align: "center", require: true, width: "100",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 9, maxLength: 20, title: "title" })),

            },
            {
                field: 'ProcessDesc', title: fields.ProcessDescription, require: true, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 60, title: "title" })),

            },
            {
                field: 'Remark', title: fields.Remark, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 120, title: "title" })),
            }
        ]
    });
    //製令工單表格
    var WorkOrderTable = new mf.Table("#WorkOrderTable", {
        uniqueId: "WorkOrderID",
        editable: false,
        paginationBar: new mf.PaginationBar("#paginagionWorkOrderBar"),
        fn_getData: function (pagination, searchData, success) {

            var Code = $("#EquipmentCode").val();

            mf.ajax({
                type: 'Get',
                url: '/MES-TD/api/IntelligentCouplet/lot00003WorkOrderGetList',
                data: ({ page: pagination.page, rows: pagination.rows, Code: Code }),
                success: function (data) {
                    ExportTotal = data.total;
                    success(data);
                }
            });
            success(data1);
        },
        fn_saveData: function (saveData, success) {

        },
        fn_onEditingRowArgsCheck: function ($row, rowdata, isAdding) {

            return null;
        },
        focusField: "Code",
        focusEditField: "Status",
        //height: window.innerHeight - 143,
        columns: [
            {
                field: 'ItemCode', title: fields.Part, align: "center", require: true, width: "100",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 9, maxLength: 20, title: "title" })),

            },
            {
                field: 'WorkOrderNo', title: fields.MoNo, require: true, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 60, title: "title" })),

            },
            {
                field: 'WorkOrderSeq', title: fields.WorkOrderSeq, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 120, title: "title" })),
            },
            {
                field: 'ProcessSeq', title: fields.ProcessSequence, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 120, title: "title" })),
            },
            {
                field: 'ProcessNo', title: fields.ProcessNo, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 120, title: "title" })),
            },
            {
                field: 'ProcessDesc', title: fields.ProcessDescription, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 120, title: "title" })),
            },
            {
                field: 'WorkCenterNo', title: fields.WorkCenterNo, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 120, title: "title" })),
            },
            {
                field: 'WorkCenterDesc', title: fields.WorkCenterDescription, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 120, title: "title" })),
            },
            {
                field: 'OperationSeq', title: fields.OperationSequence, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 120, title: "title" })),
            },
            {
                field: 'OperationNo', title: fields.Operation, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 120, title: "title" })),
            },
            {
                field: 'OperationDesc', title: fields.OperationDescription, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 120, title: "title" })),
            },
            {
                field: 'StartDate', title: fields.WorkStartDate, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 120, title: "title" })),
            },
            {
                field: 'FinishDate', title: fields.WorkEndDate, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 120, title: "title" })),
            },
            {
                field: 'Status', title: fields.Status, align: "center", width: "80",
            }
        ]
    });
    //DAQ事件表格
    var DAQEventTable = new mf.Table("#DAQEventTable", {
        uniqueId: "DAQEventID",
        editable: false,
        paginationBar: new mf.PaginationBar("#paginagionDAQEventBar"),
        fn_getData: function (pagination, searchData, success) {

            var Code = $("#EquipmentCode").val();

            //mf.ajax({
            //    type: 'Get',
            //    url: '/MES-TD/api/IntelligentCouplet/lot00003DAQEventGetList',
            //    data: ({ page: pagination.page, rows: pagination.rows, DAQMachID: Code}),
            //    success: function (data) {
            //        ExportTotal = data.total;
            //        success(data);
            //    }
            //});
            success(data1);
        },
        fn_saveData: function (saveData, success) {

        },
        fn_onEditingRowArgsCheck: function ($row, rowdata, isAdding) {

            return null;
        },
        focusField: "Code",
        focusEditField: "Status",
        //height: window.innerHeight - 143,
        columns: [
            {
                field: 'MeasureTime', title: fields.MeasureTime, align: "center", require: true, width: "100",
                rander: new mf.TextTimeRander(),

            },
            {
                field: 'EventID', title: fields.DAQEventCode, require: true, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 60, title: "title" })),

            },
            {
                field: 'EventDesc', title: fields.DAQEventDesc, align: "center", width: "150",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 120, title: "title" })),
            },
            {
                field: 'DeviceDesc', title: fields.DAQDeviceDesc, align: "center", width: "80",
                rander: new mf.WirteOnceOnlyRander(new mf.TextRander({ size: 16, maxLength: 120, title: "title" })),
            }
        ]
    });
    // 開啟工作中心
    this.WorkCenter = function () {
        if ($("#EquipmentID").text() == "") {
            msg.info(fields.info, fields.EquipmentIsNull);
            return;
        }
        $("#WorkCenterDialog").modal("show");
        $("#WorkCenterDialog").modal({ backdrop: 'static', keyboard: false });
        WorkCenterTable.loadData();

    }
    // 開啟製令工單
    this.WorkOrder = function () {
        if ($("#EquipmentID").text() == "") {
            msg.info(fields.info, fields.EquipmentIsNull);
            return;
        }

        $("#WorkOrderDialog").modal("show");
        $("#WorkOrderDialog").modal({ backdrop: 'static', keyboard: false });
        WorkOrderTable.loadData();

    }
    // 開啟DAQ事件
    this.DAQEvent = function () {
        if ($("#EquipmentID").text() == "") {
            msg.info(fields.info, fields.EquipmentIsNull);
            return;
        }

        $("#DAQEventDialog").modal("show");
        $("#DAQEventDialog").modal({ backdrop: 'static', keyboard: false });
        DAQEventTable.loadData();

    }
    // 開啟製程關係
    this.ProcessClick = function (obj) {
        $("#ProcessDialog").modal("show");
        $("#ProcessDialog").modal({ backdrop: 'static', keyboard: false });

        $Row = $(obj).closest("tr");
        var row = WorkCenterTable.getRowData($Row);
        if (row) {
            $("#WorkCenterCode").text(row.WorkCenterCode);
            $("#WorkCenterDesc").text(row.WorkCenterDesc);
        }
        ProcessTable.loadData();
    }
    // 關畢製程關係時清除
    this.clearProcess = function () {
        $("#WorkCenterCode").text("");
        $("#WorkCenterDesc").text("");
    }

    //打印
    this.printClick = function () {

    }

    // 返回
    this.backClick = function () {
        window.top.page_parameters.Caching.push({ URL: parameters.parentUrl, Parameters: parameters.parentMID });
        window.location.href = parameters.parentUrl;
    }

}

var parameters = window.top.page_parameters.GetParameters("/MES/IntelligentCouplet/IOT00002Machine");

var URL = "/MES/IntelligentCouplet/IOT00002Machine";

var MID = window.top.page_parameters.GetParameters(URL);

var arrayWord = [
    "Equipment", "EquipmentName", "ResourceType", "MechanicalCondition", "EquipmentInformation", "EquipmentCode", "EquipmentMasterFile",
    "Refresh", "Search", "Save", "New", "Change", "Deletion", "Langwage", "Import", "Export", "Status", "Print",
    "Normal", "Invalid", "PleaseSelectFile", "Browse", "info", "Cancel", "Site", "Factory", "Usage", "SourceClass", "TrendChart",
    "WorkCenter", "WorkOrder2", "DAQEvent", "WorkCenterNo", "WorkCenterDescription", "DepartmentNo", "DepartmentDescription",
    "ProcessRelating", "DAQDeviceDesc", "DAQEventDesc", "DAQEventCode", "WorkOrderNo", "WorkOrderSeq", "ProcessSequence",
    "ProcessNo", "ProcessDescription", "OperationSequence", "Operation", "MoNo", "WorkStartDate", "WorkEndDate", "MeasureTime",
    "Comfirm", "Remark", "Part", "EquipmentIsNull", "SensorNo", "SensorDescription", "PresentValue", "OperationDescription",// "", "", ""
];

words = arrayWord.join();

var model = null;

//初始页面数据，包括获取语系数据等
initPage = function () {
    model = new viewModel();
};